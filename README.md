# ADDS Lab Clone

A PowerShell script designed to automate the post-clone hardening and configuration of a Domain Controller (DC) cloned from a production environment for use in an **isolated** lab environment.

## ‚ö†Ô∏è CRITICAL WARNING

**THIS SCRIPT IS FOR ISOLATED LAB ENVIRONMENTS ONLY.**

**DO NOT RUN THIS SCRIPT IN A PRODUCTION ENVIRONMENT.**

This script performs destructive actions such as seizing FSMO roles, removing other Domain Controllers from configuration, and resetting user passwords. It is intended to be run on a **cloned** VM that has been completely isolated from the production network.

## Overview

When building a lab environment from a production Active Directory clone, significant cleanup is required to make the environment stable and safe. This script automates the following:

1.  **Clean up Sites & Services:** Recursively removes all other Domain Controller objects, ensuring only the local DC remains.
2.  **Rename Domain Controller:** Renames the server to a new name (handles the required reboot).
3.  **Network Configuration:** updates AD Sites and Subnets to match the lab network layout.
4.  **FSMO Roles:** Seizes all FSMO roles to the local DC.
5.  **UPN Suffix Configuration:** Adds a new lab UPN suffix (e.g., `lab.local`) and removes production suffixes.
6.  **User UPN Updates:** Updates all enabled users to use the new lab UPN suffix.
7.  **Security Hardening:** Rotates the `krbtgt` account password twice.
8.  **Bulk Password Reset:** Resets passwords for all enabled user accounts to random strong values (exports credentials to CSV).
9.  **Lab Admin Creation:** Creates a dedicated `labadmin` Domain Admin account.

## Prerequisites

-   **User Privileges:** You must be a member of the **Domain Admins** group.
-   **Execution Context:** The script must be run from an **Elevated** PowerShell command window (Run as Administrator).
-   **Isolation:** The machine must be network-isolated from the production environment.

## Compatibility

This project has been explicitly tested on:
-   **Windows Server 2016 ADDS**

*We welcome feedback and testing reports for other Windows Server versions.*

## Usage

To run the script, open an **Elevated PowerShell** window and execute the following command:

```powershell
powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; irm 'https://raw.githubusercontent.com/Proaxiom-Cyber/adds-labclone/main/adds-lab-clone.ps1' | iex"
```

### Dry Run Mode
The script includes a "Dry Run" mode which will verify steps and simulate actions without making changes to the directory. You will be prompted to enable this at the start of execution.

## Outputs

-   **Log File:** A detailed execution log is generated in the same directory as the script.
-   **Password CSV:** If password resets occur, a CSV file containing the new credentials (including the `labadmin` account) is generated. **Protect this file carefully.**

## üõ°Ô∏è Important Security Note

**Post-Use Cleanup is Mandatory.**

After you have verified your lab environment is functioning correctly, you must ensure that any artifacts from the import process are securely destroyed. This includes:
1.  Deleting any **backups** or **snapshots** taken of the production system during the export/import process (e.g., on the hypervisor).
2.  Securely deleting the **original imported disk images** or VHDX files used to seed the lab.
3.  Deleting the **Password CSV** file generated by this script once credentials have been secured.

Failure to do so may leave production hashes and sensitive data exposed in less secure locations.

## Disclaimer

This software is provided "as is", without warranty of any kind. Use at your own risk. Ensure you are operating in a strictly isolated environment before execution.

